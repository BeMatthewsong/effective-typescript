# [아이템 51] 의존성 분리를 위해 미러 타입 사용하기

> 미러링 기법으로 필요한 선언부만 추출하여 의존성을 분리하자

## 미러링이란?

책에서 말하는 미러링은 말 그대로 타입을 동일하게 구현하는 것을 의미한다.

예를 들어 특정 라이브러리에서 `type point = [number, number]` 이라는 타입을 가지고 있을 때, 이를 동일하게 선언하는 것을 미러링이라고 한다.

## 미러링을 사용하는 경우

라이브러리를 개발할 때 타입 선언이 `@types`에 의존할 때가 있다. 이럴 경우에는 `@types` 의존성과 무관한 라이브러리 사용자들에게 문제가 생기게 된다.

예시로 특정 라이브러리가 `@types/node`의 `Buffer` 타입에 의존한다고 하자. 이때 다음 두 그룹의 사용자들은 각자가 사용하지 않는 의존성이 라이브러리에 포함되어 있기에 문제가 생긴다.

- `@types`와 무관한 자바스크립트 개발자
- `NodeJS`와 무관한 타입스크립트 웹 개발자

이를 해결하기 위해 `Buffer`을 미러링해서 필요한 선언부만 추출해 더 짧고 실제 필요한 부분만을 명시해줄 수 있다. 이를 통해 모든 사용자에게 더 나은 사양을 제공할 수 있다.

## 주의할 점

프로젝트의 의존성이 다양해질 수록 미러링 기법을 적용하기 어려워진다.

다른 라이브러리의 타입 선언 대부분을 추출해야한다면 차라리 `@types` 의존성을 추가하는 것이 낫다.

## 미러링 예시

CSV 파일을 파싱하는 라이브러리를 만든다고 했을 때, 해당 API는 CSV 파일의 내용을 매개변수로 받게 된다. 이때 NodeJS 사용자들을 위해 매개변수에 `Buffer`(NodeJS에서 바이너리 데이터 스트림을 다루는데 사용되는 클래스) 타입을 추가하면 다음과 같이 코드가 구성된다.

```ts
function parseCSV(contents: string | Buffer) {
  ...
}
```

이떄 Buffer의 타입 정보는 NodeJS 타입 선언을 설치해야 얻을 수 있다.

```
npm install -D @types/node
```

그러나 이와 같이 devDependencies로 포함하면 위에서 언급한 그룹들의 개발자들에게 문제가 생기므로 다음과 같이 미러링 타입을 사용하는 것이 좋다.

```ts
interface CSVBuffer {
  toString(encoding: string) : string;
}

function parseCSV(contents: string | CSVBuffer) {
  ...
}
```
