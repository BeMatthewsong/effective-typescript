# **아이템46. 타입 선언과 관련된 세 가지 버전 이해하기**

## ⭐️ 3줄 요약

### 1. 라이브러리 `/@types/TypeScript` 버전이 모두 타입과 관련이 있음

### 2. 라이브러리를 업데이트하는 경우 `@types`도 업데이트하기

### 3. `TypeScript`로 작성된 라이브러리라면 타입을 자체적으로 갖고, 반대라면 `DefinitelyTyped`에 공개하는 것을 권장

<hr/>

`TypeScript`를 사용할 때는 세 가지를 주의해야 한다.

1. 라이브러리의 버전
2. 타입 선언 (`@types`)의 버전
3. TypeScript의 버전

위 세 가지가 서로 일치하지(호환되지) 않으면 엉뚱한 곳에서 오류가 발생할 수 있다.

메이저/마이너 버전이 일치한다면 타입에 대한 문제는 없다. (패치는 일치하지 않아도 됨)
아래의 예시에서 버전(16.8)은 일치

```node
   $ npm install react
   + react@16.8.6

   $npm install --save-dev @types/react
   + @types/react@16.8.19
```

### 1️⃣ 타입 별도 관리의 문제점

라이브러리와 타입 버전이 별도로 관리될 때, 몇 가지 문제가 발생할 수 있다.

1. **라이브러리와 타입의 버전이 일치하지 않는 경우**

   - 즉, 라이브러리를 업데이트했지만 실수로 타입 선언은 업데이트하지 않은 경우 => 이런 경우 라이브러리 업데이트와 관련된 새로운 기능을 사용하려 할 때마다 타입 오류 발생
   - 라이브러리보다 타입 선언의 버전이 최신인 경우 => 타입 정보 없이 라이브러리를 사용해 오다가 타입 선언을 설치하려고 할 때 뒤늦게 발생, 타입 체커는 최신 API를 기준으로 코드를 검사하게 되지만 런타임에 실제로 쓰이는 것은 과거 버전

<br/>

2. **현재 `TypeScript` 버전보다 더 높은 버전을 요구하는 라이브러리를 사용하는 경우**

   - 로대시(Lodash), 리액트(React), 람다(Ramda) 같은 유명 자바스크립트 라이브러리의 타입 정보를 더 정확하게 표현하기 위해서 타입스크립트에서 타입 시스템이 개선되고 버전이 올라감
   - 보통 `@types` 선언 자체에서 타입 오류가 발생 => 이 오류를 해결하기 위해서는 프로젝트의 타입스크립트 버전을 올리거나, 라이브러리 타입 선언의 버전을 원래대로 내리거나, declare module 선언으로 라이브러리의 타입 정보를 덮어 씌워버리면 됨. 만약 특정 버전에 대한 타입 정보를 설치하려면 아래와 같이 하면 된다.
     ```node
      $ npm install --save-dev @types/lodash@ts3.1
     ```

<br/>

3. **`@types`의 의존성이 중복되면서 버전이 다른 경우**

세 가지 경우 모두 설치된 버전을 맞춰주면 해결. 주의할 점은 어떤 것을 설치/업데이트하면 버전이 항상 일치하는지 체크하는 것이 중요!

<hr/>

### 2️⃣ 타입을 함께 관리 시 문제점

`axios` 같은 라이브러리는 타입이 분리되어 있지 않다. (`@types/axios` 같은 것은 없음)
이와 같은 방식을 번들링 방식이라고 부르는데 이 방식의 문제점을 알아보자.

1. **번들된 타입 선언에 보강 기법으로 해결할 수 없는 문제가 있는 경우 (또는 공개 시점에는 잘 동작했지만 타입스크립트 버전이 올라가면서 오류 발생하는 경우)**
   - `@types`을 별도로 사용하는 경우라면 라이브러리 자체의 버전에 맞추어 선택할 수 있음. 하지만 번들된 타입에서는 `@types`의 버전 선택 불가능

<br/>

2. **프로젝트 내의 타입 선언이 다른 라이브러리의 타입 선언에 의존하는 경우**
   - 보통 의존성이 `devDependencies`에 들어감. 프로젝트 공개 시, 다른 사용자가 설치하게 되면 `devDependencies`가 설치되지 않아 오류 발생

<br/>

3. **프로젝트 과거 버전의 타입에 문제가 있는 경우**
   - `DefinitelyTyped`는 동일 라이브러리의 여러 버전의 타입 선언을 동시에 유지보수할 수 있는 매커니즘을 가짐

<br/>

4. **타입 선언에 대한 업데이트의 어려움**
   - `DefinitelyTyped`는 커뮤니티에서 관리되기 때문에 타입선언에 대한 패치 작업량을 감당할 수 있음

### 3️⃣ 공식적인 권장 사항

##### 라이브러리가 타입스크립트로 작성된 경우만 타입 선언을 라이브러리에 포함

##### 자바스크립트로 작성된 라이브러리라면 손수 작성한 타입 선언은 오류가 있을 가능성이 높고 잦은 업데이트가 필요하므로, DefinitelyTyped에 공개하여 커뮤니티에서 관리하고 유지보수하도록 맡기는 것이 좋음

<hr/>

#### --save-dev 옵션의 의미

https://velog.io/@vekkary/-save-dev-%EC%98%B5%EC%85%98%EC%9D%98-%EC%9D%98%EB%AF%B8
